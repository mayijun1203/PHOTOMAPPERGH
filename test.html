<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.12.0/mapbox-gl.css' rel='stylesheet' />

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: sans-serif;
        }

        #mainmap {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>
</head>

<body>
    <div class="container-fluid p-0" id="mainmap"> </div> <!-- placeholder for main map -->

    <script>
        'use strict';
        // Set MapBox token
        mapboxgl.accessToken = 'pk.eyJ1IjoibWF5aWp1biIsImEiOiJjaXg4ZmlyY20wMDBjMm9tcjI0bjQ0Z21zIn0.Io0XJ4JelN903V9HGo4TfQ'; // still need to find a way to store the token


        // Initialize the map
        const map = new mapboxgl.Map({ // creating a new map
            container: 'mainmap', // same as the div id to place the map
            style: 'mapbox://styles/mapbox/light-v10', // light base map
            hash: true, // make sure it's on to get the url with map view
            preserveDrawingBuffer: true, // make sure it's on to allow printing
            center: [119.655953, 29.093875], // testing to get the centroid of bounds
            zoom: 11, // set the initial zoom of the map view
        });


        // Add layers
        map.on('load', function () {
            map.loadImage(
                'https://raw.githubusercontent.com/mayijun1203/PHOTOVIZGH/main/icon.png',
                (error, image) => {
                    if (error) throw error;

                    // Add the image to the map style.
                    map.addImage('cat', image);

                    console.log(image);

                    const layerContentList = []; // store all the layer contents

                    // Add full screen control
                    map.addControl(new mapboxgl.FullscreenControl({
                        container: document.querySelector('body'),
                    }),
                        'bottom-left', // control position
                    );

                    // Add navigation control
                    map.addControl(new mapboxgl.NavigationControl({
                        showCompass: true, // show compass
                        showZoom: true, // show zoom
                        visualizePitch: true, // show pitch
                    }),
                        'bottom-left', // control position
                    );


                    // Add points
                    // Set layer contents
                    const layerContent = {
                        'sourceid': 'ptsource', // source id
                        'sourcetype': 'geojson', // source type
                        'sourcedata': 'photoviz.geojson', // data source
                        'cluster': true, // whether enable clustering
                        'clustermaxzoom': 14, // max zoom level for clustering
                        'clusterradius': 50, // radius of clusters
                        'unclusteredid': 'unclustered', // layer id
                        'unclusteredtype': 'symbol', // symbology type
                        'unclusteredvisibility': 'visible', // visibility of the layer
                        'unclusterediconimage': '', // icon image
                        'unclusteredcolor': 'rgba(255,0,0,1)', // color for each category; use rgba
                        'unclusteredopacity': 1, // circle opacity
                        'unclusteredradius': { 'base': 2, 'stops': [[12, 4], [22, 180]] }, // circle radius; change size based on zoom level
                        'unclusteredhalocolor': 'rgb(255,255,255)', // circle stroke color
                        'unclusteredhalowidth': 0, // circle stroke width
                        'unclusteredoutlinecolor': 'rgba(255,255,255,0)',  // outline color; for legend purpose only
                        'clusteredid': 'clustered', // layer id
                        'clusteredtype': 'circle', // symbology type
                        'clusteredvisibility': 'visible', // visibility of the layer
                        'clusteredcolor': ['step', ['get', 'point_count'], '#51bbd6', 1, '#f1f075', 3, '#f28cb1'], // color for each category; use rgba
                        'clusteredopacity': 1, // circle opacity
                        'clusteredradius': ['step', ['get', 'point_count'], 20, 100, 30, 750, 40], // circle radius; change size based on point counts
                        'clusteredstrokecolor': 'rgb(255,255,255)', // circle stroke color
                        'clusteredstrokeopacity': 1, // circle stroke opacity
                        'clusteredstrokewidth': 0, // circle stroke width
                        'clusteredoutlinecolor': 'rgba(255,255,255,0)',  // outline color; for legend purpose only
                        'clusterlabelid': 'clusterlabel',
                        'clusterlabeltype': 'symbol', // symbology type
                        'clusterlabelvisibility': 'visible', // visibility of the layer
                        'clusterlabeltextfield': ['get', 'point_count_abbreviated'], // text for the cluster label
                        'clusterlabeltextfont': ['Open Sans Semibold', 'Arial Unicode MS Bold'], // text font for the cluster label
                        'clusterlabeltextsize': 14, // text size for the cluster label
                    };

                    // Add data source
                    map.addSource(layerContent['sourceid'], {
                        'type': layerContent['sourcetype'],
                        'data': layerContent['sourcedata'],
                    });

                    // Add unclustered circle layer
                    map.addLayer({
                        'id': layerContent['unclusteredid'],
                        'type': layerContent['unclusteredtype'],
                        'source': layerContent['sourceid'],
                        'layout': {
                            'visibility': 'visible',
                            'icon-image': 'cat',
                            'icon-size': 0.1,
                        },
                        'paint': {
                            'icon-color': layerContent['unclusteredcolor'],
                            'icon-opacity': layerContent['unclusteredopacity'],
                            'icon-halo-color': layerContent['unclusteredhalocolor'],
                            'icon-halo-width': layerContent['unclusteredhalowidth'],
                        },
                    });
                });
        });
    </script>
</body>

</html>